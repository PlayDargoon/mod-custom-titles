# GM Команды для управления кастомными званиями

## Доступ
Все команды доступны только **Game Master (GM)** и выше.

## Список команд

### 1. Просмотр всех званий
```
.ctitle list
```
Показывает список всех доступных кастомных званий с их ID и названиями.

**Пример вывода:**
```
=== Список всех кастомных званий ===
ID: 178 | Муж: %s Посланник Азерота | Жен: %s Посланница Азерота | Mask: 143
ID: 179 | Муж: %s Тестовое Звание | Жен: %s Тестовое Звание | Mask: 144
```

---

### 2. Выдать звание игроку
```
.ctitle add <имя_игрока> <id>
```
Выдает указанное звание игроку и автоматически активирует его.

**Параметры:**
- `<имя_игрока>` - имя персонажа (игрок должен быть онлайн)
- `<id>` - ID звания из таблицы custom_titles

**Примеры:**
```
.ctitle add Пан 178
.ctitle add Артас 179
```

**Что происходит:**
- Звание записывается в базу данных
- Битовая маска устанавливается в PLAYER__FIELD_KNOWN_TITLES
- Игрок получает уведомление в чате
- Звание становится активным автоматически

---

### 3. Снять звание с игрока
```
.ctitle remove <имя_игрока>
```
Удаляет кастомное звание у указанного игрока.

**Параметры:**
- `<имя_игрока>` - имя персонажа (игрок должен быть онлайн)

**Примеры:**
```
.ctitle remove Пан
.ctitle remove Артас
```

**Что происходит:**
- Звание удаляется из базы данных
- Игрок получает уведомление об удалении

---

### 4. Перезагрузить звания
```
.ctitle reload
```
Перезагружает все кастомные звания из таблицы `custom_titles` без перезапуска сервера.

**Доступ:** Только Administrator

**Использование:**
- После добавления новых званий в таблицу custom_titles
- После изменения существующих званий

---

## Примеры использования

### Сценарий 1: Выдача звания за ивент
```
1. GM проверяет список званий:
   .ctitle list

2. GM выдает звание победителю:
   .ctitle add ИмяПобедителя 178

3. Игрок видит сообщение:
   "GM выдал вам кастомное звание: Посланник Азерота"
```

### Сценарий 2: Снятие звания за нарушение
```
1. GM снимает звание:
   .ctitle remove ИмяНарушителя

2. Игрок видит сообщение:
   "GM снял ваше кастомное звание."
```

### Сценарий 3: Добавление новых званий
```
1. Администратор добавляет новые звания в базу через SQL
2. Администратор перезагружает звания:
   .ctitle reload

3. Система выводит:
   "Кастомные звания перезагружены. Всего загружено: 12"
```

---

## Технические детали

### Отображение званий
Кастомные звания отображаются:
- **При входе в игру** - объявление с названием звания
- **В чате** - если включено в конфиге

### База данных
Звания хранятся в двух таблицах:
- **acore_world_test.custom_titles** - список всех доступных званий
- **acore_characters.character_custom_titles** - звания, полученные игроками

### Формат названий
Используйте плейсхолдер `%s` для имени персонажа:
- `%s Посланник Азерота` → "Пан Посланник Азерота"
- `Легендарный %s` → "Легендарный Пан"

---

## Важные замечания

1. **Игрок должен быть онлайн** для выдачи/снятия звания
2. **Только одно активное звание** у игрока одновременно
3. **Mask_ID** должен соответствовать CharTitles.dbc (используйте 143+)
4. **GM уровень** - SEC_GAMEMASTER или выше

---

## Решение проблем

### Звание не отображается
- Проверьте, что Mask_ID корректный
- Убедитесь, что игрок перелогинился

### Команда не работает
- Проверьте уровень доступа GM (.gm on)
- Убедитесь, что модуль включен в конфиге

### Игрок не найден
- Убедитесь, что игрок онлайн
- Проверьте правильность написания имени
