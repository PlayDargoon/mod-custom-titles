# Редактирование текстов писем без перекомпиляции

## Обзор

Все тексты поздравительных писем хранятся в базе данных, что позволяет редактировать их без перекомпиляции модуля.

## Добавление нового звания с письмом

### 1. Добавьте звание в таблицу custom_titles

```sql
INSERT INTO `custom_titles` 
(`ID`, `condition_ID`, `name13`, `name_female13`, `mask_ID`) 
VALUES 
(194, 0, 'Новое Звание', 'Новое Звание', 145);
```

### 2. Добавьте шаблон письма

```sql
INSERT INTO `custom_title_mails` (`title_id`, `mail_subject`, `mail_body`, `comment`) 
VALUES 
(194, 'Поздравляем с получением звания!',
'Поздравляем, {PLAYER_NAME}!\n\nТебе присвоено почетное звание {TITLE_NAME}.\n\nТвои заслуги навсегда останутся в памяти этого мира!\n\nС уважением,\nКоманда Azeroth',
'Новое Звание');
```

### 3. Перезагрузите звания

Используйте команду в игре:
```
.ctitle reload
```

## Редактирование существующего письма

### Изменить тему письма

```sql
UPDATE `custom_title_mails` 
SET `mail_subject` = 'Новая тема письма!' 
WHERE `title_id` = 179;
```

### Изменить текст письма

```sql
UPDATE `custom_title_mails` 
SET `mail_body` = 'Поздравляем, {PLAYER_NAME}!\n\nНовый текст письма.\n\nС уважением,\nКоманда Azeroth' 
WHERE `title_id` = 179;
```

### Изменения применяются мгновенно

После выполнения SQL команды изменения вступают в силу **немедленно**, без перезапуска сервера или перекомпиляции!

## Плейсхолдеры

В тексте письма можно использовать специальные плейсхолдеры:

| Плейсхолдер | Описание | Пример результата |
|-------------|----------|-------------------|
| `{PLAYER_NAME}` | Имя игрока | "Артас" |
| `{TITLE_NAME}` | Название звания | "Хардкорный Выживший" |
| `\n` | Перенос строки | Новая строка в тексте |

## Примеры использования плейсхолдеров

### Пример 1: Персонализированное обращение

```sql
UPDATE `custom_title_mails` 
SET `mail_body` = 'Привет, {PLAYER_NAME}!\n\nМы рады сообщить тебе о получении звания {TITLE_NAME}!\n\nПоздравляем!' 
WHERE `title_id` = 180;
```

Результат для игрока "Артас" со званием "Тестировщик":
```
Привет, Артас!

Мы рады сообщить тебе о получении звания Тестировщик!

Поздравляем!
```

### Пример 2: Без имени игрока

```sql
UPDATE `custom_title_mails` 
SET `mail_body` = 'Тебе присвоено звание {TITLE_NAME}!\n\nТвои достижения впечатляют!' 
WHERE `title_id` = 181;
```

### Пример 3: Формальное письмо

```sql
UPDATE `custom_title_mails` 
SET `mail_body` = 'Уважаемый {PLAYER_NAME},\n\nАдминистрация сервера уведомляет Вас о присвоении звания:\n{TITLE_NAME}\n\nС уважением,\nКоманда Azeroth' 
WHERE `title_id` = 182;
```

## Массовое редактирование

### Изменить тему для всех писем

```sql
UPDATE `custom_title_mails` 
SET `mail_subject` = 'Новое достижение!';
```

### Добавить префикс ко всем текстам

```sql
UPDATE `custom_title_mails` 
SET `mail_body` = CONCAT('[ВАЖНО]\n\n', mail_body);
```

### Заменить подпись во всех письмах

```sql
UPDATE `custom_title_mails` 
SET `mail_body` = REPLACE(mail_body, 'Команда Azeroth', 'Администрация');
```

## Просмотр всех шаблонов

```sql
SELECT title_id, mail_subject, comment 
FROM custom_title_mails 
ORDER BY title_id;
```

## Просмотр конкретного шаблона

```sql
SELECT * 
FROM custom_title_mails 
WHERE title_id = 186;
```

## Резервное копирование

Перед массовыми изменениями создайте резервную копию:

```sql
CREATE TABLE custom_title_mails_backup AS 
SELECT * FROM custom_title_mails;
```

Восстановление из резервной копии:

```sql
DELETE FROM custom_title_mails;
INSERT INTO custom_title_mails SELECT * FROM custom_title_mails_backup;
```

## Удаление письма

Если вы не хотите отправлять письмо для конкретного звания:

```sql
DELETE FROM custom_title_mails WHERE title_id = 179;
```

При отсутствии шаблона будет отправлено стандартное письмо, и в лог будет записано предупреждение.

## Настройки в конфигурации

В файле `mod_custom_titles.conf` вы можете полностью отключить систему писем:

```ini
# Отправлять письма игрокам при получении звания
CustomTitles.SendMail = 0
```

Это отключит отправку писем для всех званий без удаления шаблонов из базы данных.

## Советы

1. **Используйте `\n`** для форматирования текста - это создаст читаемую структуру письма
2. **Всегда используйте {PLAYER_NAME}** - это делает письмо персональным
3. **Тестируйте на тестовом сервере** - проверьте как выглядит письмо в игре
4. **Сохраняйте резервные копии** перед массовыми изменениями
5. **Используйте comment** для заметок о звании

## Пример: Добавление 100 новых званий

```sql
-- Добавляем звания (194-293)
INSERT INTO custom_titles (ID, condition_ID, name13, name_female13, mask_ID) VALUES
(194, 0, 'Звание 1', 'Звание 1', 145),
(195, 0, 'Звание 2', 'Звание 2', 146),
-- ... еще 98 записей ...
(293, 0, 'Звание 100', 'Звание 100', 244);

-- Добавляем шаблоны писем для всех
INSERT INTO custom_title_mails (title_id, mail_subject, mail_body, comment) VALUES
(194, 'Поздравляем!', 'Поздравляем, {PLAYER_NAME}!\n\nТы получил звание {TITLE_NAME}!', 'Звание 1'),
(195, 'Поздравляем!', 'Поздравляем, {PLAYER_NAME}!\n\nТы получил звание {TITLE_NAME}!', 'Звание 2'),
-- ... еще 98 записей ...
(293, 'Поздравляем!', 'Поздравляем, {PLAYER_NAME}!\n\nТы получил звание {TITLE_NAME}!', 'Звание 100');

-- Все это делается БЕЗ перекомпиляции модуля!
```

## Проверка работы

После добавления/изменения письма:

1. Выдайте звание игроку: `.ctitle add <player> <id>`
2. Проверьте почту в игре
3. Проверьте логи сервера:
   - `Title mail sent to player...` - письмо успешно отправлено
   - `Mail template not found...` - шаблон не найден, использован стандартный
