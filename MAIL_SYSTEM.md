# Система писем для модуля Custom Titles

## Что добавлено

### Функция отправки писем
- **SendTitleMail()** - отправляет персонализированное письмо игроку при получении звания
- Письмо приходит от "Команды Azeroth" с GM оформлением (MAIL_STATIONERY_GM)
- Каждому из 15 званий соответствует уникальный текст поздравления

### Интеграция
- Функция автоматически вызывается в команде `.ctitle add` после:
  1. Сохранения звания в базу данных
  2. Отправки сообщения игроку
  3. Анонса на весь сервер
  4. **Отправки письма** (новое!)

## Формат писем

### Тема письма
`Поздравляем с получением звания!`

### Структура текста
```
Поздравляем, [Имя игрока]!

[Уникальный текст для каждого звания]

Твои заслуги навсегда останутся в памяти этого мира!

С уважением,
Команда Azeroth
```

## Примеры писем

### ID 179 - из Команды Azeroth
```
Поздравляем, PlayerName!

Ты стал частью легендарной Команды Azeroth!
Это звание подчеркивает твою преданность и вклад в развитие нашего мира.

Твои заслуги навсегда останутся в памяти этого мира!

С уважением,
Команда Azeroth
```

### ID 186 - Хардкорный Выживший
```
Поздравляем, PlayerName!

За прохождение испытания Hardcore, тебе присвоено почетное звание Хардкорный Выживший.
Ты выжил там, где смерть означает конец пути. Твоя стойкость легендарна!

Твои заслуги навсегда останутся в памяти этого мира!

С уважением,
Команда Azeroth
```

### ID 193 - Железный Человек
```
Поздравляем, PlayerName!

За прохождение испытания Iron Man Mode, тебе присвоено почетное звание Железный Человек.
Ты преодолел все ограничения сразу! Ты - настоящая легенда!

Твои заслуги навсегда останутся в памяти этого мира!

С уважением,
Команда Azeroth
```

## Технические детали

### Используемые классы
- **MailDraft** - формирование письма
- **MailSender** - отправитель (MAIL_NORMAL, 0, MAIL_STATIONERY_GM)
- **MailReceiver** - получатель (игрок)

### Хранение шаблонов
Все шаблоны писем хранятся в базе данных **acore_world** в таблице **custom_title_mails**.

Структура таблицы:
- `title_id` - ID звания (PRIMARY KEY)
- `mail_subject` - тема письма
- `mail_body` - текст письма с плейсхолдерами
- `comment` - комментарий (название звания)

### Плейсхолдеры
В тексте письма можно использовать:
- `{PLAYER_NAME}` - автоматически заменяется на имя игрока
- `{TITLE_NAME}` - автоматически заменяется на название полученного звания
- `\n` - перенос строки

### Логирование
Каждое отправленное письмо записывается в лог:
```
"Title mail sent to player {PlayerName} for title ID {TitleID}"
```

Если шаблон письма не найден:
```
"Mail template not found for title ID {TitleID}. Using default template."
```

## Файлы изменены
- `CustomTitles.cpp` - добавлена функция SendTitleMail() и её вызов в HandleCustomTitleAddCommand()
- Добавлен #include "Mail.h"

## Компиляция
После внесения изменений необходимо:
```bash
cd /root/azerothcore_test/build
make -j$(nproc)
```

## Тестирование
1. Войти в игру с GM-правами
2. Выбрать игрока или взять в таргет
3. Выполнить команду: `.ctitle add <id>`
4. Проверить:
   - Сообщение в чате игроку
   - Анонс на сервер
   - **Письмо на игровой почте** ✉️

## Примечания
- Письма отправляются мгновенно (не требуют ожидания)
- Игрок может получить письмо даже если не в сети (при следующем входе)
- Письма приходят с GM-оформлением (золотой текст и особая визуализация)
